<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js Maze</title>
		<link rel="stylesheet" href="style.css">
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<!-- Text area for timer -->
		<div id="timer"style="width:100%;height:50px;top:50px;text-align: center; color:white;" class="ui"></div>
	
		<script type="module">
			import * as THREE from "../Js/three.module.js"; //Importing three library to allow for animated 3D graphics in a browser
			import * as CANNON from "../Js/cannon-es.js"; //Importing cannon library for inclusion of a physics engine
			import CannonDebugger from "../Js/cannon-es-debugger.js";
			import { OrbitControls } from "../Js/OrbitControls.js"; //Importing orbit controls libray to allow user to manually adjust perspective of the scene
			import { GLTFLoader } from "../Js/GLTFLoader.js"; //Importing GLTF loader to allow imports of 3D models of type .gltf
			
			let insetWidth = window.innerWidth/4, insetHeight = window.innerHeight/4; //Setting width and height of the top view camera

			//Getting dom element for text box to display time for the timer
			const timerTextBox = document.getElementById("timer");

			const canvas = document.querySelector('#c');
			
			//Class dedicated to the movement of the character and updating the perspective and orthograpic cameras
			class CharacterControls{// made with help from Genka https://youtu.be/C3s0UHpwlf8
				
				//temporary data
				walkDirection= new THREE.Vector3();
				rotateAngle= new THREE.Vector3(0,1,0);
				rotateQuarternion=new THREE.Quaternion();
				cameraTarget=new THREE.Vector3();
				
				//constants
				fadeDuration =0.2
				velocity=20
				
				//Initialising variables of CharacterControl class through constructor
				constructor(model,camera,cameraTop,currentAction,orbitControl,modelBody){
					this.model=model;
					this.modelBody=modelBody
					this.camera=camera;
					this.cameraTop=cameraTop;
					this.number=3;
					this.currentAction=currentAction;
					this.orbitControl = orbitControl;
				}
				//used to update the direction of the camera
				directionOffset(keysPressed){
					var directionOffset = 0 //arrow up
					if (keysPressed['arrowup']) {
						directionOffset = Math.PI //arrow up						
					}
					else if (keysPressed['arrowdown']) {
						directionOffset = 0 //arrow down						
					}
					else if (keysPressed['arrowleft']) {
						directionOffset = -Math.PI / 2 //arrow left
					}
					else if (keysPressed['arrowright']) {
						directionOffset = Math.PI / 2 //arrow right
					}
					return directionOffset		
				}
				//updates the camera position, and orbit controls
				updateCameraTarget(moveX, moveZ) {
					this.camera.position.x -= moveX//move camera
            		this.camera.position.z -= moveZ
					
					this.cameraTarget.x = this.model.position.x// update camera target
					this.cameraTarget.y = this.model.position.y+15 
					this.cameraTarget.z = this.model.position.z
					this.orbitControl.target = this.cameraTarget

					this.cameraTop.position.x = this.model.position.x//move top camera
					this.cameraTop.position.z = this.model.position.z
					this.cameraTop.lookAt(this.model.position);//update top camera target
				}
							
				//event that updates model and camera
				update(delta, keysPressed){//delta is frame number
					var directionPressed=null;
					var state='';
					//console.log(typeof(keysPressed))
					for(var key in keysPressed){
						if(keysPressed[key]==true){
							//console.log(key)
							directionPressed=key
							if(directionPressed=='r'){
								document.location.reload()
							}
							if((directionPressed=='arrowup'||directionPressed=='arrowdown'||directionPressed=='arrowleft'||directionPressed=='arrowright')==false){
								return
							}
							//console.log(keysPressed)
						}
					}
					if(directionPressed){
						state='walk'
					}
					else{
						state='idle'
					}
					if(this.currentAction!=state){ 
						//changed from walk to idle or vise versa, this is where youd put the code for animations
						this.currentAction=state;
					}
					if(this.currentAction=='walk'){
						//calc direction towards the camera
						var angleYCameraDirection = Math.atan2(
                    	(this.camera.position.x - this.model.position.x), 
                    	(this.camera.position.z - this.model.position.z))
						//calc movement angle offset
						var directionOffset= this.directionOffset(keysPressed)
						//console.log(directionOffset)
						// rotate model
						this.rotateQuarternion.setFromAxisAngle(this.rotateAngle, angleYCameraDirection + directionOffset)
           				this.model.quaternion.rotateTowards(this.rotateQuarternion, 0.2)
						//this.camera.quaternion.rotateTowards(this.rotateQuarternion, 0.2)

						// calculate direction
            			this.camera.getWorldDirection(this.walkDirection)
        			    this.walkDirection.y = 0
            			this.walkDirection.normalize()
            			this.walkDirection.applyAxisAngle(this.rotateAngle, directionOffset)

						//move model and camera
						const moveX = this.walkDirection.x * this.velocity * delta//calculate direction to move on x axis
            			const moveZ = this.walkDirection.z * this.velocity * delta
            			this.modelBody.position.x -= moveX//update position of model
            			this.modelBody.position.z -= moveZ
            			//move the camera with them
						this.updateCameraTarget(moveX,moveZ);//call function to update multiple camera position and targets
					}
				}
			}

			
			//Initialise the scene
			const scene = new THREE.Scene();
			const world = new CANNON.World({
				//gravity: new CANNON.Vec3(0,-9.81,0)
			});
			const cannonDebugger = new CannonDebugger(scene, world,{
				color: 0xffffff, //wireframe colour
				scale: 1,
			});
			const timeStep = 1/60;
			scene.background = new THREE.Color("black");

			//clock used to animate model and ghosts
			var clock = new THREE.Clock();
			//global variables for model and the physics body of the model
			var modelBody, model, skyBox, fire, puddle, level, exit, keysPressed, totalTime;
			//global variables for ghosts and model border boxes
			var modelBB, ghost, ghostBB, ghost2, ghost2BB, ghost3, ghost3BB, ghost4, ghost4BB;
			level = 1;

			function levelControl(model,camera,cameraTop,controls, modelBB, ghostBB){//function that controls all the levels and different ways character can die
				let positionX=model.position.x;
				let positionZ=model.position.z;
				
				//Function for the countdown timers for level 2 and 3
				function levelTimer()
				{	
					//Function to decrease value of totalTime variable by 1 every second and display it
					function decrementTimer()
					{
						if(totalTime > 0 && level >= 2)
						{
							setTimeout(decrementTimer, 1000);
							totalTime--;
							timerTextBox.textContent = totalTime;
						}
						else if(totalTime<=0) //Checking if player has run out of time and lost the game
						{
							window.alert("You have run out of time!\nBetter luck next time.");
							document.location.reload()
						}
					}
					decrementTimer();
				}


				if(level==3){//animate ghost and check for colision
					//only animate ghosts if on level 3
					ghost.position.x=(4*clock.elapsedTime%300)-120//300 is total length of x axis, 120 is the lowest x value
					ghost2.position.z=(4*clock.elapsedTime%275)-100//275 is the length of z axis, -100 is the lowest y value
					ghost3.position.x=(-4*clock.elapsedTime%300)+180//300 is the length of x axis, 180 is the biggest x value
					ghost4.position.z=(4*clock.elapsedTime%275)-100//275 is the length of z axis, -100 is the lowest y value
					if(modelBB.intersectsBox(ghostBB)){	//check for colision
						window.alert('The ghost has eaten you')
						document.location.reload()
					}
					if(modelBB.intersectsBox(ghost2BB)){	//check for colision
						window.alert('You have been slain')
						document.location.reload()
					}
					if(modelBB.intersectsBox(ghost3BB)){	//check for colision
						window.alert('Whoops!\nYou have gotten too close to the ghost')
						document.location.reload()
					}
					if(modelBB.intersectsBox(ghost4BB)){	//check for colision
						window.alert('You can now play with Casper...\nForever')
						document.location.reload()
					}
				}

				
				if(11<positionX&&positionX<29&&21<positionZ&&positionZ<39){ //walk into fire is warm
					//175,175
					window.alert("You have died!\nFires are quite dangerous...");
					document.location.reload()
				}					
				

				if(-10<positionX&&positionX<0&&10<positionZ&&positionZ<30&&level == 1){ //checks if first level has been completed
					//175,175
					changePosition(model,camera,cameraTop,controls,0,-0.2,30,0,20,35)//move to look at fire
					keysPressed ={ };//clear the event listner
					window.alert("You've made it to the centre. Congrats");
					window.alert("Oh no! There appears to be a fire.\nGo find water to put it out before the timer runs out!");
					level++;
					
					totalTime = 180;//time to complete level 2
					levelTimer();//starts the timer
				}
				else if(-70>positionX&&positionX>-80&&-60>positionZ&&positionZ>-70&& level == 2){ //checks if second level has been completed
					//175,175
					keysPressed ={ };
					window.alert("Congrats you have found the water\nUnfortunately...");
					window.alert("You took too long, the maze people have died in the fire.\nEscape the maze without disturbing the ghosts");				
					scene.remove(exit)//unblocks the exit
					ghost.position.y = 5;//puts the ghosts into view
					ghost2.position.y=5
					ghost3.position.y=5
					ghost4.position.y=5
					totalTime = 250;//time to complete level 3
					level++;
				}	
				else if(173<positionX&&positionX<180&&165<positionZ&&positionZ<175&& level == 3){ //checks if final level has been completed
					//175,175
					keysPressed ={ };
					window.alert("Congratulations, Challenger\nYou have successfully escaped the maze!\nYou have won the game!");
					document.location.reload();
				}	
			}

			function changePosition(model,camera,cameraTop,controls,x,y,z,cx,cy,cz){//function used to move entire model and cameras to new position
				camera.position.y = cy;		//position camera and orbit controls
				camera.position.z = cz;
				controls.target=new THREE.Vector3(x,15,z);
				controls.update()

				cameraTop.position.x = x; //above position of model
				cameraTop.position.y = 30;//standard height
				cameraTop.position.z = z;
				cameraTop.lookAt(x,y,z);//Updating target of the top camera

				model.position.x = x; //position of model
				model.position.y = y;
				model.position.z = z;				
			}

			function wall(){//used to create a long wall, for the maze
				var wallGeometry = new THREE.BoxGeometry(30,25,1);
				var wallTexture = new THREE.TextureLoader().load( "Textures/TexturesCom_BrickOldDirty0132_1_seamless_S.jpg" );
				wallTexture.wrapT = THREE.RepeatWrapping;
				wallTexture.wrapS = THREE.RepeatWrapping;
				wallTexture.repeat.set(3,3);
				var wallMat = new THREE.MeshPhongMaterial({ map : wallTexture });
				var walltmp = new THREE.Mesh(wallGeometry, wallMat);
				walltmp.castShadow = true; //to enable shadows - default is false 
				walltmp.receiveShadow = true; //to enable shadows - default

				return walltmp;
			}

			function wallShort(){//used to create a short wall, for the maze
				var wallGeometry = new THREE.BoxGeometry(10, 25, 1);
				var wallTexture = new THREE.TextureLoader().load( "Textures/TexturesCom_BrickOldDirty0132_1_seamless_S.jpg" );
				wallTexture.wrapT = THREE.RepeatWrapping;
				wallTexture.wrapS = THREE.RepeatWrapping;
				wallTexture.repeat.set(3,3);
				var wallMat = new THREE.MeshPhongMaterial({ map: wallTexture });
				var wallBump = new THREE.TextureLoader().load( "NormalMap-Textures/TexturesCom_BrickOldDirty0132_1_seamless_S.jpg" );
				wallMat.bumpMap = wallBump;
				wallMat.bumpScale = 0.5;
				var walltmp = new THREE.Mesh(wallGeometry, wallMat);
				walltmp.castShadow = true; //to enable shadows - default is false 
				walltmp.receiveShadow = true; //to enable shadows - default
				return walltmp;
			}

			function physicsMaze(){//function that creates the phsics maze
				var wallShape = new CANNON.Box(new CANNON.Vec3(15,6,0.5));
				var wallShapeRotated = new CANNON.Box(new CANNON.Vec3(0.5,6,15));

				var shortWallShape = new CANNON.Box(new CANNON.Vec3(5,6,0.5));
				var shortWallShapeRotated = new CANNON.Box(new CANNON.Vec3(0.5,6,5));
				
				var mazeBody = new CANNON.Body({
					mass: 0,
					shape: wallShape
				})

				mazeBody.addShape(wallShape, new CANNON.Vec3(30,0,0), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-30,0,0), new CANNON.Quaternion());

				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-10,0,5),new CANNON.Quaternion());
				//person 3 starts
				//side floating
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-70, 0, 0), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-70, 0, -20), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-85, 0, -20), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-100, 0, -20), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-85, 0, 0), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-95, 0, 0), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-100, 0, 5), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-100, 0, 25), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-100, 0, 45), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-100, 0, 55), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-95, 0, 70), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-90, 0, 75), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-90, 0, 85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-90, 0, 95), new CANNON.Quaternion());

				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-85, 0, 100), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-80, 0, 115), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-95, 0, 40), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-85, 0, 40), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-105, 0, 100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-110, 0, 125), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-105, 0, 120), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-100, 0, 115), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-100, 0, -35), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-90, 0, -35), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-105, 0, -50), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-105, 0, -70), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-90, 0, -55), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-75, 0, -50), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-90, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-70, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-65, 0, -70), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-60, 0, -65), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-50, 0, -65), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-45, 0, -65), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-40, 0, -50), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-90, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-80, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-75, 0, -95), new CANNON.Quaternion());

				//inside upper walls of maze
				mazeBody.addShape(wallShape, new CANNON.Vec3(-40, 0, -10), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-25, 0, -15), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-10, 0, -20), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(20, 0, -20), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(50, 0, -20), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(15, 0, -15), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(0, 0, -10), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(30, 0, -10), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(35, 0, -5), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65, 0, -15), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(80, 0, -10), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-25, 0, -50), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(5, 0, -50), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(35, 0, -50), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(55, 0, -50), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(80, 0, -50), new CANNON.Quaternion());

				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(95, 0, -45), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(95, 0, -35), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(80, 0, -55), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(95, 0, -70), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(100, 0, -30), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(105, 0, -45), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(105, 0, -70), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(105, 0, -65), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(105, 0, -80), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(95, 0, -95), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(90, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(120, 0, -95), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(135, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(135, 0, -60), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(160, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(120, 0, -45), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(120, 0, -25), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(155, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(155, 0, -60), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-50, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-20, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-40, 0, -85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-20, 0, -85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-20, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-20, 0, -70), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-5, 0, -65), new CANNON.Quaternion());

				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(10, 0, -60), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(10, 0, -55), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(10, 0, -80), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(30, 0, -80), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(45, 0, -95), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(45, 0, -85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(15, 0, -85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(20, 0, -90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(35, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(35, 0, -95), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(50, 0, -65), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(60, 0, -65), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65, 0, -70), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65, 0, -80), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(80, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(110, 0, -75), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(105, 0, -10), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(160, 0, -10), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(140, 0, -10), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(125, 0, -45), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(135, 0, -25), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(140, 0, -30), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(145, 0, -35), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(150, 0, -40), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(155, 0, -40), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(160, 0, -35), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(135, 0, -5), new CANNON.Quaternion());
				//person 3 ends

				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(45,0,15), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(45,0,30), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(45,0,45), new CANNON.Quaternion());

				mazeBody.addShape(wallShape, new CANNON.Vec3(0,0,60), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(30,0,60), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(60,0,60), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(70,0,60), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(60,0,30), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(75,0,30), new CANNON.Quaternion());

				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(60,0,55),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(70,0,40),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(80,0,40),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(85,0,45),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(50,0,20),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(75,0,15),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(70,0,10),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65,0,5),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(85,0,0),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(95,0,0),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(100,0,5),new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(120,0,10), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(105,0,10),new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(90,0,20), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(120,0,20), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(145,0,20), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(160,0,15), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(155,0,0),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(150,0,5),new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(100,0,45), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(95,0,30),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(100,0,25),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(100,0,35),new CANNON.Quaternion());

				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(115,0,45), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(115,0,60), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(120,0,30), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(130,0,30), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(135,0,35),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(140,0,40), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(150,0,40), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(155,0,55), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(155,0,70),new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(140,0,60), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(150,0,60), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(115,0,80), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(120,0,85), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(135,0,85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(100,0,85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(95,0,90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(90,0,95), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(85,0,90), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(70,0,85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(50,0,85), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(45,0,100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(40,0,100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(30,0,100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(35,0,95), new CANNON.Quaternion());

				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(15,0,100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(10,0,100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(20,0,115), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(30,0,115), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(35,0,120), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(50,0,125), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(80,0,125), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-5,0,100), new CANNON.Quaternion());

				mazeBody.addShape(wallShape, new CANNON.Vec3(80,0,110), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65,0,105), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(100,0,110), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(115,0,115), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(120,0,130), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(130,0,130), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(140,0,130), new CANNON.Quaternion());
                mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(135,0,105), new CANNON.Quaternion());
                mazeBody.addShape(shortWallShape, new CANNON.Vec3(150,0,130), new CANNON.Quaternion());
                mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(155,0,130), new CANNON.Quaternion());
                mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(135,0,135), new CANNON.Quaternion());

				mazeBody.addShape(wallShape, new CANNON.Vec3(-30,0,100), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-15,0,45), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-30,0,40), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-40,0,15), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-50,0,15), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-55,0,10), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-55,0,-10), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-70,0,25), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-70,0,-45), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-55,0,-40), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-55,0,-30), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-70,0,40), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-75,0,55), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-80,0,60), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-65,0,65), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-45,0,55), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-50,0,60), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-45,0,35), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-30,0,25), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-30,0,15), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-25,0,20), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-30,0,45), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-75,0,70), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-75,0,80), new CANNON.Quaternion());
				//person 2 ends

				//person 4

				//upper boundary of the wall
				mazeBody.addShape(wallShape, new CANNON.Vec3(-100,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-70,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-40,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-10,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(20,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(50,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(80,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(110,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(140,0,-100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(160,0,-100), new CANNON.Quaternion());

				//left boundary of the wall
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,-85), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,-80), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,-50), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,-20), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,10), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,30), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,50), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,70), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,90), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,110), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,130), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,150), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-115,0,160), new CANNON.Quaternion());

				//bottom boundary of the maze
				mazeBody.addShape(wallShape, new CANNON.Vec3(-100,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-75,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-45,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-15,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(15,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(30,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(60,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(90,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(120,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(150,0,175), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(160,0,175), new CANNON.Quaternion());

				//right boundary of the wall
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,150), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,130), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,100), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,70), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,40), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,10), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,-20), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,-50), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,-80), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(175,0,-85), new CANNON.Quaternion());

				//Person 2 physics maze begin
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(50,0,170), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(50,0,160), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(55,0,155), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(60,0,155), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65,0,150), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(65,0,160), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(100,0,170), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(100,0,160), new CANNON.Quaternion());

				mazeBody.addShape(wallShape, new CANNON.Vec3(150,0,100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(170,0,100), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(130,0,145), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(150,0,145), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(115,0,140), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(100,0,135), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(45,0,130), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(40,0,135), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(35,0,140), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(30,0,145), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(25,0,140), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(10,0,125), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(20,0,125), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(5,0,130), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(5,0,150), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(0,0,115), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(15,0,150), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(15,0,170), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(85,0,140), new CANNON.Quaternion());

				mazeBody.addShape(wallShape, new CANNON.Vec3(-20,0,85), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-40,0,85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-55,0,90), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-60,0,95), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-65,0,100), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-10,0,130), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-50,0,120), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-55,0,125), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-70,0,130), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-90,0,130), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-70,0,145), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-45,0,160), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-50,0,145), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-95,0,145), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-5,0,145), new CANNON.Quaternion());
				mazeBody.addShape(wallShape, new CANNON.Vec3(-20,0,160), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShape, new CANNON.Vec3(-70,0,85), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-45,0,105), new CANNON.Quaternion());
				mazeBody.addShape(shortWallShapeRotated, new CANNON.Vec3(-45,0,115), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-15,0,115), new CANNON.Quaternion());
				mazeBody.addShape(wallShapeRotated, new CANNON.Vec3(-35,0,145), new CANNON.Quaternion());
				//Person 2 physics maze end
				return mazeBody;
			}

			function maze(){//function that returns a maze
				var maze = new THREE.Object3D();
				//exit of maze
				exit=wallShort().translateX(175).translateZ(170).rotateY(Math.PI / 2)
				scene.add(exit)

				maze.add(wall());
				maze.add(wall().translateX(30));
				maze.add(wall().translateX(-30));

				//person 1 starts
                maze.add(wallShort().translateX(-10).translateZ(5).rotateY(Math.PI / 2));
				maze.add(wall().translateX(45).translateZ(15).rotateY(Math.PI / 2));
				maze.add(wall().translateX(45).translateZ(30).rotateY(Math.PI / 2));
				maze.add(wall().translateX(45).translateZ(45).rotateY(Math.PI / 2));

				maze.add(wall().translateZ(60));
				maze.add(wall().translateX(30).translateZ(60));
				maze.add(wall().translateX(60).translateZ(60));
				maze.add(wall().translateX(70).translateZ(60));
				maze.add(wall().translateX(60).translateZ(30));
				maze.add(wall().translateX(75).translateZ(30));

				maze.add(wallShort().translateX(60).translateZ(55).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(70).translateZ(40));
				maze.add(wallShort().translateX(80).translateZ(40));
				maze.add(wallShort().translateX(85).translateZ(45).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(50).translateZ(20));
				maze.add(wallShort().translateX(75).translateZ(15).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(70).translateZ(10));
				maze.add(wallShort().translateX(65).translateZ(5).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(85).translateZ(0));
				maze.add(wallShort().translateX(95).translateZ(0));
				maze.add(wallShort().translateX(100).translateZ(5).rotateY(Math.PI / 2));
				maze.add(wall().translateX(120).translateZ(10));
				maze.add(wallShort().translateX(105).translateZ(10));
				maze.add(wall().translateX(90).translateZ(20));
				maze.add(wall().translateX(120).translateZ(20));
				maze.add(wall().translateX(145).translateZ(20));
				maze.add(wall().translateX(160).translateZ(15).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(155).translateZ(0));
				maze.add(wallShort().translateX(150).translateZ(5).rotateY(Math.PI / 2));
				maze.add(wall().translateX(100).translateZ(45));
				maze.add(wallShort().translateX(95).translateZ(30));
				maze.add(wallShort().translateX(100).translateZ(25).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(100).translateZ(35).rotateY(Math.PI / 2));

				maze.add(wall().translateX(115).translateZ(45).rotateY(Math.PI / 2));
				maze.add(wall().translateX(115).translateZ(60).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(120).translateZ(30));
				maze.add(wallShort().translateX(130).translateZ(30));
				maze.add(wallShort().translateX(135).translateZ(35).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(140).translateZ(40));
				maze.add(wallShort().translateX(150).translateZ(40));
				maze.add(wall().translateX(155).translateZ(55).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(155).translateZ(70).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(140).translateZ(60));
				maze.add(wallShort().translateX(150).translateZ(60));
				maze.add(wallShort().translateX(115).translateZ(80).rotateY(Math.PI / 2));
				maze.add(wall().translateX(120).translateZ(85));
                maze.add(wall().translateX(135).translateZ(85).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(100).translateZ(85));
				maze.add(wallShort().translateX(95).translateZ(90).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(90).translateZ(95));
				maze.add(wallShort().translateX(85).translateZ(90).rotateY(Math.PI / 2));
				maze.add(wall().translateX(70).translateZ(85));
				maze.add(wallShort().translateX(50).translateZ(85));
				maze.add(wall().translateX(45).translateZ(100).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(40).translateZ(100));
				maze.add(wallShort().translateX(30).translateZ(100));
				maze.add(wallShort().translateX(35).translateZ(95).rotateY(Math.PI / 2));

				maze.add(wall().translateX(15).translateZ(100).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(10).translateZ(100));
				maze.add(wallShort().translateX(20).translateZ(115));
				maze.add(wallShort().translateX(30).translateZ(115));
				maze.add(wallShort().translateX(35).translateZ(120).rotateY(Math.PI / 2));
				maze.add(wall().translateX(50).translateZ(125));
				maze.add(wall().translateX(80).translateZ(125));
				maze.add(wall().translateX(-5).translateZ(100).rotateY(Math.PI / 2));
				
				maze.add(wall().translateX(80).translateZ(110));
				maze.add(wallShort().translateX(65).translateZ(105).rotateY(Math.PI / 2));
				maze.add(wall().translateX(100).translateZ(110));
				maze.add(wall().translateX(115).translateZ(115).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(120).translateZ(130));
				maze.add(wallShort().translateX(130).translateZ(130));
				maze.add(wallShort().translateX(140).translateZ(130));
				maze.add(wallShort().translateX(135).translateZ(105).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(150).translateZ(130));
				maze.add(wall().translateX(155).translateZ(130).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(135).translateZ(135).rotateY(Math.PI / 2));
				//person 1 ends

				//person 2 starts
				maze.add(wallShort().translateX(50).translateZ(170).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(50).translateZ(160).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(55).translateZ(155));
				maze.add(wallShort().translateX(60).translateZ(155));
				maze.add(wallShort().translateX(65).translateZ(150).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(65).translateZ(160).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(100).translateZ(170).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(100).translateZ(160).rotateY(Math.PI / 2));

				maze.add(wall().translateX(150).translateZ(100));
				maze.add(wallShort().translateX(170).translateZ(100));
				maze.add(wall().translateX(130).translateZ(145));
				maze.add(wallShort().translateX(150).translateZ(145));
				maze.add(wallShort().translateX(115).translateZ(140).rotateY(Math.PI / 2));
				maze.add(wall().translateX(100).translateZ(135));
				maze.add(wallShort().translateX(45).translateZ(130).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(40).translateZ(135));
				maze.add(wallShort().translateX(35).translateZ(140).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(30).translateZ(145));
				maze.add(wall().translateX(25).translateZ(140).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(10).translateZ(125));
				maze.add(wallShort().translateX(20).translateZ(125));
				maze.add(wall().translateX(5).translateZ(130).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(5).translateZ(150).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(0).translateZ(115));
				maze.add(wall().translateX(15).translateZ(150).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(15).translateZ(170).rotateY(Math.PI / 2));
				maze.add(wall().translateX(85).translateZ(140).rotateY(Math.PI / 2));

				maze.add(wall().translateX(-20).translateZ(85));
				maze.add(wall().translateX(-40).translateZ(85));
				maze.add(wallShort().translateX(-55).translateZ(90).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-60).translateZ(95));
				maze.add(wall().translateX(-65).translateZ(100).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-10).translateZ(130));
				maze.add(wallShort().translateX(-50).translateZ(120));
				maze.add(wallShort().translateX(-55).translateZ(125).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-70).translateZ(130));
				maze.add(wallShort().translateX(-90).translateZ(130));
				maze.add(wall().translateX(-70).translateZ(145));
				maze.add(wall().translateX(-45).translateZ(160).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-50).translateZ(145));
				maze.add(wall().translateX(-80).translateZ(160));
				maze.add(wall().translateX(-95).translateZ(145).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-5).translateZ(145).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-20).translateZ(160));
				maze.add(wallShort().translateX(-70).translateZ(85));
				maze.add(wallShort().translateX(-45).translateZ(105).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-45).translateZ(115).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-15).translateZ(115).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-35).translateZ(145).rotateY(Math.PI / 2));
				
				maze.add(wall().translateX(-30).translateZ(100));
				maze.add(wall().translateX(-15).translateZ(45).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-30).translateZ(40));
				maze.add(wallShort().translateX(-40).translateZ(15));
				maze.add(wallShort().translateX(-50).translateZ(15));
				maze.add(wall().translateX(-55).translateZ(10).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-55).translateZ(-10).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-70).translateZ(25));
				maze.add(wall().translateX(-70).translateZ(-45));
				maze.add(wallShort().translateX(-55).translateZ(-40).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-55).translateZ(-30).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-70).translateZ(40).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-75).translateZ(55));
				maze.add(wallShort().translateX(-80).translateZ(60).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-65).translateZ(65));
				maze.add(wallShort().translateX(-45).translateZ(55));
				maze.add(wallShort().translateX(-50).translateZ(60).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-45).translateZ(35).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-30).translateZ(25));
				maze.add(wallShort().translateX(-30).translateZ(15));
				maze.add(wallShort().translateX(-25).translateZ(20).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-30).translateZ(45).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-75).translateZ(70).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-75).translateZ(80).rotateY(Math.PI / 2));
				//person 2 ends

				//person 3 starts

				//side floating
				maze.add(wall().translateX(-70).translateZ(0).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-70).translateZ(-20).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-85).translateZ(-20));
				maze.add(wall().translateX(-100).translateZ(-20));
				maze.add(wall().translateX(-85).translateZ(0));
				maze.add(wallShort().translateX(-95).translateZ(0));
				maze.add(wallShort().translateX(-100).translateZ(5).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-100).translateZ(25).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-100).translateZ(45).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-100).translateZ(55).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-95).translateZ(70));
				maze.add(wallShort().translateX(-90).translateZ(75).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-90).translateZ(85).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-90).translateZ(95).rotateY(Math.PI / 2));
				
				maze.add(wallShort().translateX(-85).translateZ(100));
				maze.add(wall().translateX(-80).translateZ(115).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-95).translateZ(40));
				maze.add(wallShort().translateX(-85).translateZ(40));
				maze.add(wall().translateX(-105).translateZ(100).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-110).translateZ(125));
				maze.add(wallShort().translateX(-105).translateZ(120).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-100).translateZ(115));
				maze.add(wallShort().translateX(-100).translateZ(-35));
				maze.add(wallShort().translateX(-90).translateZ(-35));
				maze.add(wall().translateX(-105).translateZ(-50).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-105).translateZ(-70).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-90).translateZ(-55));
				maze.add(wallShort().translateX(-75).translateZ(-50).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-90).translateZ(-75));
				maze.add(wallShort().translateX(-70).translateZ(-75));
				maze.add(wallShort().translateX(-65).translateZ(-70).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-60).translateZ(-65));
				maze.add(wallShort().translateX(-50).translateZ(-65));
				maze.add(wallShort().translateX(-45).translateZ(-65));
				maze.add(wall().translateX(-40).translateZ(-50).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-90).translateZ(-90));
				maze.add(wallShort().translateX(-80).translateZ(-90));
				maze.add(wallShort().translateX(-75).translateZ(-95).rotateY(Math.PI / 2));
                
    			//inside upper walls of maze
				maze.add(wall().translateX(-40).translateZ(-10));
				maze.add(wallShort().translateX(-25).translateZ(-15).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-10).translateZ(-20));
				maze.add(wall().translateX(20).translateZ(-20));
				maze.add(wall().translateX(50).translateZ(-20));
				maze.add(wallShort().translateX(15).translateZ(-15).rotateY(Math.PI / 2));
				maze.add(wall().translateX(0).translateZ(-10));
				maze.add(wallShort().translateX(30).translateZ(-10));
				maze.add(wallShort().translateX(35).translateZ(-5).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(65).translateZ(-15).rotateY(Math.PI / 2));
				maze.add(wall().translateX(80).translateZ(-10));
				maze.add(wall().translateX(-25).translateZ(-50));
				maze.add(wall().translateX(5).translateZ(-50));
				maze.add(wall().translateX(35).translateZ(-50));
				maze.add(wall().translateX(55).translateZ(-50));
				maze.add(wall().translateX(80).translateZ(-50));
				maze.add(wallShort().translateX(95).translateZ(-45).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(95).translateZ(-35).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(80).translateZ(-55).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(95).translateZ(-70).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(100).translateZ(-30));
				maze.add(wall().translateX(105).translateZ(-45).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(105).translateZ(-70).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(105).translateZ(-65).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(105).translateZ(-80).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(95).translateZ(-95).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(90).translateZ(-90));
				maze.add(wallShort().translateX(120).translateZ(-95).rotateY(Math.PI / 2));
				maze.add(wall().translateX(135).translateZ(-90));
				maze.add(wall().translateX(135).translateZ(-60));
				maze.add(wall().translateX(160).translateZ(-75).rotateY(Math.PI / 2));
				maze.add(wall().translateX(120).translateZ(-45).rotateY(Math.PI / 2));
				maze.add(wall().translateX(120).translateZ(-25).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(155).translateZ(-90));
				maze.add(wallShort().translateX(155).translateZ(-60));
				maze.add(wall().translateX(-50).translateZ(-90));
				maze.add(wall().translateX(-20).translateZ(-90));
				maze.add(wallShort().translateX(-40).translateZ(-85).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-20).translateZ(-85).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-20).translateZ(-75).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(-20).translateZ(-70).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-5).translateZ(-65));
				maze.add(wallShort().translateX(10).translateZ(-60).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(10).translateZ(-55).rotateY(Math.PI / 2));
				maze.add(wall().translateX(10).translateZ(-80));
				maze.add(wall().translateX(30).translateZ(-80));
				maze.add(wallShort().translateX(45).translateZ(-95).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(45).translateZ(-85).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(15).translateZ(-85).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(20).translateZ(-90));
				maze.add(wallShort().translateX(35).translateZ(-75).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(35).translateZ(-95).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(50).translateZ(-65));
				maze.add(wallShort().translateX(60).translateZ(-65));
				maze.add(wallShort().translateX(65).translateZ(-70).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(65).translateZ(-75).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(65).translateZ(-80).rotateY(Math.PI / 2));
				maze.add(wall().translateX(80).translateZ(-75));
				maze.add(wall().translateX(110).translateZ(-75));
				maze.add(wall().translateX(105).translateZ(-10));
				maze.add(wall().translateX(160).translateZ(-10));
				maze.add(wallShort().translateX(140).translateZ(-10));
				maze.add(wallShort().translateX(125).translateZ(-45));
				maze.add(wallShort().translateX(135).translateZ(-25).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(140).translateZ(-30));
				maze.add(wallShort().translateX(145).translateZ(-35).rotateY(Math.PI / 2));
				maze.add(wallShort().translateX(150).translateZ(-40));
				maze.add(wallShort().translateX(155).translateZ(-40));
				maze.add(wallShort().translateX(160).translateZ(-35).rotateY(Math.PI / 2));
				maze.add(wall().translateX(135).translateZ(-5).rotateY(Math.PI / 2));
				//person 3 ends

				//person 4 starts

				//upper boundary of the wall
				maze.add(wall().translateX(-100).translateZ(-100));
				maze.add(wall().translateX(-70).translateZ(-100));
				maze.add(wall().translateX(-40).translateZ(-100));
				maze.add(wall().translateX(-10).translateZ(-100));
				maze.add(wall().translateX(20).translateZ(-100));
				maze.add(wall().translateX(50).translateZ(-100));
				maze.add(wall().translateX(80).translateZ(-100));
				maze.add(wall().translateX(110).translateZ(-100));
				maze.add(wall().translateX(140).translateZ(-100));
				maze.add(wall().translateX(160).translateZ(-100));

				//left boundary of the wall
				maze.add(wall().translateX(-115).translateZ(-85).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(-80).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(-50).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(-20).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(10).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(30).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(50).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(70).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(90).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(110).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(130).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(150).rotateY(Math.PI / 2));
				maze.add(wall().translateX(-115).translateZ(160).rotateY(Math.PI / 2));

				//bottom boundary of the maze
				maze.add(wall().translateX(-100).translateZ(175));
				maze.add(wall().translateX(-75).translateZ(175));
				maze.add(wall().translateX(-45).translateZ(175));
				maze.add(wall().translateX(-15).translateZ(175));
				maze.add(wall().translateX(15).translateZ(175));
				maze.add(wall().translateX(30).translateZ(175));
				maze.add(wall().translateX(60).translateZ(175));
				maze.add(wall().translateX(90).translateZ(175));
				maze.add(wall().translateX(120).translateZ(175));
				maze.add(wall().translateX(150).translateZ(175));
				maze.add(wall().translateX(160).translateZ(175));

				//right boundary of the wall
				maze.add(wall().translateX(175).translateZ(150).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(130).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(100).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(70).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(40).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(10).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(-20).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(-50).rotateY(Math.PI / 2));
				maze.add(wall().translateX(175).translateZ(-80).rotateY(Math.PI / 2));
			    maze.add(wall().translateX(175).translateZ(-85).rotateY(Math.PI / 2));
			
				return maze;
			}

			function floor(){
				var floorGeometry = new THREE.PlaneGeometry(500, 500, 1, 1);
				var floorTexture = new THREE.TextureLoader().load( "Textures/TexturesCom_FloorsMedieval0063_2_S.jpg" );
				floorTexture.wrapT = THREE.RepeatWrapping;
				floorTexture.wrapS = THREE.RepeatWrapping;
				floorTexture.repeat.set(50,50);
				var floorMat = new THREE.MeshLambertMaterial({ map : floorTexture});
				var floor = new THREE.Mesh(floorGeometry, floorMat);
				floor.rotation.x = -0.5 * Math.PI;
				floor.receiveShadow = true; //enables floor to receive a shadow

				return floor; 			
			}

			function skybox(){
				let materialArray = [];
				let texture_ft = new THREE.TextureLoader().load("Textures/nightsky/nightskycolor_ft.png");
				let texture_bk = new THREE.TextureLoader().load("Textures/nightsky/nightskycolor_bk.png");
				let texture_up = new THREE.TextureLoader().load("Textures/nightsky/nightskycolor_up.png");
				let texture_dn = new THREE.TextureLoader().load("Textures/nightsky/nightskycolor_dn.png");
				let texture_rt = new THREE.TextureLoader().load("Textures/nightsky/nightskycolor_rt.png");
				let texture_lf = new THREE.TextureLoader().load("Textures/nightsky/nightskycolor_lf.png");
				
				materialArray.push(new THREE.MeshBasicMaterial({map: texture_ft}));
				materialArray.push(new THREE.MeshBasicMaterial({ map: texture_bk}));
				materialArray.push(new THREE.MeshBasicMaterial({ map: texture_up}));
				materialArray.push(new THREE.MeshBasicMaterial({ map: texture_dn}));
				materialArray.push(new THREE.MeshBasicMaterial({ map: texture_rt}));
				materialArray.push(new THREE.MeshBasicMaterial({ map: texture_lf}));

				for (let i = 0; i < 6; i++) {
					materialArray[i].side = THREE.BackSide;
				}
				let skyBoxGeo = new THREE.BoxGeometry(600,600,600);
				let skyBox = new THREE.Mesh(skyBoxGeo, materialArray);
				return skyBox;
			}

			Init();
			
			function Init(){
				// Initialise the renderer
				const renderer = new THREE.WebGLRenderer({ antialias: true }, { alpha: true }, { autoclear: false });
				renderer.shadowMap.enabled = true; //to render point light shadows
				renderer.shadowMap.type = THREE.PCFSoftShadowMap; //to render point light shadows
				renderer.setSize(window.innerWidth,window.innerHeight);
				renderer.setPixelRatio(window.devicePixelRatio);
				document.body.appendChild(renderer.domElement);

				// initialise the camera------------------------------------------------------------------
				var camera = new THREE.PerspectiveCamera(60,window.innerWidth / window.innerHeight, 1, 1000);
				//camera.position.set(-900,-200,-900);
				camera.position.x = 115;
				camera.position.y = 20;
				camera.position.z = -92;
				//z=5 y=20

				//Initialising top camera-----------------------------------------------------------------
				let cameraTop = new THREE.PerspectiveCamera(90,window.innerWidth / window.innerHeight, 0.01, 500);
				cameraTop.position.x = 130;
				cameraTop.position.y = 30;
				cameraTop.position.z = -95;

				cameraTop.lookAt(130,0,-95);
				cameraTop.name = "OverheadCam";

				//add orbit control-----------------------------------------------------------------------
				let controls = new OrbitControls(camera, renderer.domElement);
				controls.enableDamping = true
				controls.minDistance = 5
				controls.maxDistance = 40
				controls.enablePan = false
				controls.maxPolarAngle = Math.PI / 2 - 0.05
				var orbitCameraTarget = new THREE.Vector3(130,15,-100);
				controls.target=orbitCameraTarget
				controls.update();
				//----------------------------------------------------------------------------------------
				//add camera
				scene.add(camera);
				
				//add skybox
				skyBox = skybox();
				scene.add(skyBox);

				//adding the floor
				scene.add(floor());
				
				//adding the maze to the scene and physical world
				scene.add(maze());
				world.addBody(physicsMaze());

				//importing the character---------------------------------------------------------------------
				let modelControls=new CharacterControls();
				var loader = new GLTFLoader();
				loader.load("Object_models/witch_cartoonish_character3.glb",
				(gltf) => {
				model = gltf.scene;
				gltf.scene.scale.set(10,10,10);
				
				var modelShape = new CANNON.Box(new CANNON.Vec3(2,2,2)); //physics shape for model
				modelBody = new CANNON.Body({
					mass: 1,
					shape: modelShape
				}) //physics body for model
				modelBody.position.x = 130;
				modelBody.position.y = -0.2;
				modelBody.position.z = -95;				

				modelBody.linearDamping = 0.9999; //prevents the body from accelerating infinitely after a collision
				world.addBody(modelBody);
				
				model.position.copy(modelBody.position); //makes the model position the same as the modelBody
				model.quaternion.copy(modelBody.quaternion); //makes the model position the same as the modelBody
				
				modelBB = new THREE.Box3(new THREE.Vector3(),new THREE.Vector3())
				modelBB.setFromObject(model);

				//model.castShadow = true; //to enable shadows - default is false 
				model.receiveShadow = true; //to enable shadows - default
				
				scene.add(model);
		
				modelControls=new CharacterControls(model,camera,cameraTop,'idle',controls,modelBody);	
				},
				undefined,
				function(error) {
				console.error(error);
				}
				);
				
				//Loading fire model into the centre of the maze------------------------------------------
				loader.load("Object_models/bonfire__dark_souls/scene.gltf",
				(gltf) => {
				fire = gltf.scene;
				gltf.scene.scale.set(5,5,5);
				gltf.scene.position.x = 20;
				gltf.scene.position.z = 30;
				//fire.setPosition(0,0,30);
				//fire.castShadow = true; //to enable shadows - default is false 
				//fire.receiveShadow = true; //to enable shadows - default
				scene.add(fire);				
				},
				undefined,
				function(error) {
				console.error(error);
				}
				);

				//Loading puddle model into the the maze----------------------------------------
				loader.load("Object_models/low_poly_-_puddle/scene.gltf",
					(gltf) => {
						puddle = gltf.scene;
						gltf.scene.scale.set(0.03, 0.03, 0.03);
						gltf.scene.position.x = -90;
						gltf.scene.position.y = 2;
						gltf.scene.position.z = -65;
						scene.add(puddle);
					},
					undefined,
					function (error) {
						console.error(error);
					}
				);

				//Loading ghost models into the the maze----------------------------------------
				loader.load("Object_models/ghost/scene.gltf",
					(gltf) => {
						ghost = gltf.scene;
						gltf.scene.scale.set(0.05, 0.05, 0.05);
						gltf.scene.position.x = 120;
						gltf.scene.position.y = -10;
						gltf.scene.position.z = -70;						
						ghostBB = new THREE.Box3(new THREE.Vector3(),new THREE.Vector3())
						ghostBB.setFromObject(ghost);
						//console.log(ghostBB)
						scene.add(ghost);
					},
					undefined,
					function (error) {
						console.error(error);
					}
				);
				loader.load("Object_models/ghost/scene.gltf",
					(gltf) => {
						ghost2 = gltf.scene;
						ghost2.scale.set(0.05, 0.05, 0.05);
						ghost2.position.x = 140;
						ghost2.position.y = -10;
						ghost2.position.z = -90;						
						ghost2BB = new THREE.Box3(new THREE.Vector3(),new THREE.Vector3())
						ghost2BB.setFromObject(ghost);
						//console.log(ghostBB)
						scene.add(ghost2);
					},
					undefined,
					function (error) {
						console.error(error);
					}
				);
				loader.load("Object_models/ghost/scene.gltf",
					(gltf) => {
						ghost3 = gltf.scene;
						ghost3.scale.set(0.05, 0.05, 0.05);
						ghost3.position.x = -140;
						ghost3.position.y = -10;
						ghost3.position.z = 160;						
						ghost3BB = new THREE.Box3(new THREE.Vector3(),new THREE.Vector3())
						ghost3BB.setFromObject(ghost);
						//console.log(ghostBB)
						scene.add(ghost3);
					},
					undefined,
					function (error) {
						console.error(error);
					}
				);
				loader.load("Object_models/ghost/scene.gltf",
					(gltf) => {
						ghost4 = gltf.scene;
						ghost4.scale.set(0.05, 0.05, 0.05);
						ghost4.position.x = 3;
						ghost4.position.y = -10;
						ghost4.position.z = 160;						
						ghost4BB = new THREE.Box3(new THREE.Vector3(),new THREE.Vector3())
						ghost4BB.setFromObject(ghost);
						//console.log(ghostBB)
						scene.add(ghost4);
					},
					undefined,
					function (error) {
						console.error(error);
					}
				);

				//Add lights-------------------------------------------------------------------------------
				const hemiLight = new THREE.HemisphereLight(0x808080, 0x000000, 0.3);
				hemiLight.position.set(0, 50, 0);
				// Add hemisphere light to scene
				scene.add(hemiLight);

				//Create a PointLight and turn on shadows for the light-----------------------------------
				const light = new THREE.PointLight(0xff0000, 1.5, 70);
				light.position.set(20, 0, 30);
				light.castShadow = true; // default false
				scene.add(light);

				//Set up shadow properties for the light
				light.shadow.mapSize.width = 512; // default
				light.shadow.mapSize.height = 512; // default
				light.shadow.camera.near = 0.5; // default
				light.shadow.camera.far = 500; // default

				//Create a DirectionalLight and turn on shadows for the light-----------------------------
				const Dlight = new THREE.DirectionalLight(0x696969, 0.5, 500);
				Dlight.position.set(-170, 20, 50); //default; light shining from top
				Dlight.castShadow = true; // default false
				scene.add(Dlight);

				//Set up shadow properties for the light
				Dlight.shadow.mapSize.width = 512; // default
				Dlight.shadow.mapSize.height = 512; // default
				Dlight.shadow.camera.near = 0.5; // default
				Dlight.shadow.camera.far = 500; // default

				//control keys------------------------------------------------------------------------------
				keysPressed ={ };//list that contains all keys pressed
				document.addEventListener('keydown', (event)=>{
					(keysPressed)[event.key.toLowerCase()]=true//on keydown, store that key as true
				},false);
				document.addEventListener('keyup', (event)=>{
					(keysPressed)[event.key.toLowerCase()]=false//on keyup, store that key as false
				},false);

				//adding background music-------------------------------------------------------------------------------------
				const listener = new THREE.AudioListener();
				camera.add(listener);

				const audioLoader = new THREE.AudioLoader(); //audio loader (loads all mp3 files)
				
				const bgSound = new THREE.Audio(listener); //for the background sound - creates a nonpositional global audio object

				audioLoader.load("Sounds/Harry Potter Theme Song.mp3", function (buffer) { //load the sound files
				bgSound.setBuffer(buffer);
				bgSound.setLoop(true);  //sound will repeat 
				bgSound.setVolume(0.5); //volume is 0-1
				bgSound.play(); //starts the sound now
				});
				scene.add(bgSound);
				//-----------------------------------------------------------------------------------------------------------
				renderer.render(scene,camera);//render the first frame then send start message
				window.alert("Welcome Challenger, you seem to have awoken in an unfamiliar area.\nMake your way to the center of the maze to get your bearings.\nUse the arrow and mouse to move the character.\nPress R to reset the game");
				
				animate();//begin animation
				function animate() {
					//rotate the skybox
					skyBox.rotation.y += 0.0001;

					//physics updates:
					//cannonDebugger.update(); //updates wireframe positions
					world.step(timeStep);
					if(model){
						model.position.copy(modelBody.position); //makes the model position the same as the modelBody
						levelControl(model,camera,cameraTop,controls,modelBB,ghostBB);
		
					}//only copies the position if the model has loaded
					
					//updates the player movement
					let mixerUpdateDelta = clock.getDelta();
					if (modelControls){
						modelControls.update(mixerUpdateDelta, keysPressed);//pass the clock delta and keys pressed into the update of the character control class
					}
					
					if(level==3){//only sync border boxes if were on level 3
						if(modelBB){//sync model border box to models position
							modelBB.setFromObject(model);
						}
						if(ghostBB){
							ghostBB.setFromObject(ghost);//sync ghost border box to ghost position
						}
						if(ghost2BB){
							ghost2BB.setFromObject(ghost2);
						}
						if(ghost3BB){
							ghost3BB.setFromObject(ghost3);
						}
						if(ghost4BB){
							ghost4BB.setFromObject(ghost4);
						}
					}
					controls.update();//update orbit controls

					//perspective camera view being rendered
					renderer.setViewport(0,0,window.innerWidth,window.innerHeight);
					renderer.render(scene,camera);

					renderer.shadowMap.enabled = false; //disable shadows to be rendered
					renderer.clearDepth();
					renderer.setScissorTest(true);//Enabling scissor test to allow for both the top camera and perspective camera to be rendered in the same window					
					renderer.setScissor(window.innerWidth-insetWidth, window.innerHeight-insetHeight, insetWidth, insetHeight);
					renderer.setViewport(window.innerWidth-insetWidth, window.innerHeight-insetHeight, insetWidth, insetHeight);
					renderer.render(scene,cameraTop);//ortho cam being rendered
					renderer.setScissorTest(false);//Disabling scissor test to allow for both the top camera and perspective camera to be rendered in the same window on the next instance of the animate function

					renderer.shadowMap.enabled = true; //enable shadows to be rendered for the main camera

					requestAnimationFrame(animate);						
				}
			}
			
			
		</script>
	</body>
</html>